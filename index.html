<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>MiniApp Packaging</title>
    <script async class="remove" src="https://www.w3.org/Tools/respec/respec-w3c"></script>

    <script class="remove">
        var respecConfig = {
            specStatus: "ED",
            copyrightStart: "2021",
            edDraftURI: "https://w3c.github.io/miniapp-packaging/",

            shortName: "miniapp-packaging",

            editors: [
                {
                    name: "Martin Alvarez-Espinar",
                    companyURL: "http://www.huawei.com",
                    company: "Huawei"
                },          
                {
                    name: "Qing An",
                    companyURL: "http://www.alibabagroup.com/en/global/home",
                    company: "Alibaba"
                },
                {
                    name: "Tengyuan Zhang",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                },         
                {
                    name: "Yongjing Zhang",
                    companyURL: "http://www.huawei.com/",
                    company: "Huawei"
                }, 
                {
                    name: "Dan Zhou",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                }
            ],
            formerEditors: [
                {
                    name: "Shouren Lan",
                    companyURL: "http://www.huawei.com/",
                    company: "Huawei"
                }, 
                {
                    name: "Zhiqiang Yu",
                    companyURL: "http://www.huawei.com/",
                    company: "Huawei"
                }, 
                {
                    name: "Qian Liu",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                }, 
                {
                    name: "Shuo Wang",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                }
            ],
            group: "wg/miniapps",
            github: {
                repoURL: "https://github.com/w3c/miniapp-packaging",
                branch: "main",
            },
            localBiblio: {
                MINIAPP_LIFECYCLE: {
                    title: "MiniApp Lifecycle",
                    href: "https://w3c.github.io/miniapp-lifecycle/"
                },
                MINIAPP_MANIFEST: {
                    title: "MiniApp Manifest",
                    href: "https://w3c.github.io/miniapp-manifest/"
                },
                APK_SIGNATURE_V2: {
                    title: "APK Signature Scheme v2",
                    href: "https://source.android.com/security/apksigning/v2"
                },
            },
            a11y: true,            
        };
    </script>
</head>

<body>
    <section id="abstract">
        <p>This specification defines semantics and conformance requirements for a [=MiniApp Package=], and the structure of the single file container that holds the resources of a MiniApp, including a [=manifest=] file, static page templates, stylesheets, JavaScript documents, media files and other resources. Instances of the [=MiniApp Package=] are used for MiniApp distribution and execution on runtime environments ([=MiniApp User Agent=]).</p>
    </section>
    <section id="sotd">
    </section>
    <section id="sec-introduction">
        <h2>Introduction</h2>
        <section>
            <h3>Overview</h3>
            <p>MiniApp is a concept of light software application, that can be distributed through any digital means, and accessed through the Web. MiniApps are defined by a concrete file structure and all the resources are comprised within a single file that represents the whole MiniApp package that can be distributed and executed by [=MiniApp User Agents=].</p>
            <p>A [=MiniApp Package=] contains a directory structure that holds the specific resources of the MiniApp that defines the rendering, operation, and interaction with the end-users — including static page templates, stylesheets, JavaScript documents, media files, and other resources — and the MiniApp Manifest. The MiniApp Manifest, located in the central directory of the package, describes the MiniApp, including information about page routing, styles, and other operational and rendering details of the MiniApp, as well as descriptive information for humans.</p>
            <p>As defined in the signature section, MiniApps MAY support digital signature verification to guarantee the integrity of the package and contents during the delivery of the package.</p>
            <p>The MiniApp runtime environment ([=MiniApp User Agent=]) identifies MiniApp package files through the standard package format and the specific MIME media type. After fetching the MiniApp package file, the [=MiniApp User Agent=] loads the static page templates, CSS, JavaScript files, and other resources into the cache, following a dereference step. These MiniApp resources will remain available in the cache until the next update, avoiding unnecessary network fetches.</p>
            <p>In terms of launch mode, the MiniApp can be launched normally when offline. The [=MiniApp User Agent=] locates the specified startup page from the package cache path and launches the MiniApp according to the description of the [=manifest=] file.</p>
        </section>
        <section id="sec-terminology">
            <h3>Terminology</h3>
            <p>The following terms are specific to MiniApps.</p>
            <dl class="termlist">
                <dt><dfn id="dfn-signature" data-lt="signatures|signature|Digital Signature|Digital Signatures" data-dfn-type="dfn">Digital Signature</dfn></dt>
                <dd>
                    <p>A cryptographic mechanism and hashing techniques to prove the authenticity of [=resources=]. Digital signatures can demonstrate the origin, time, identity, and status of [=resources=] and of the [=MiniApp Package=].</p>
                    <p>The usual scenario of MiniApps may involve two kinds of signatures: application developer signature, which gives a recipient strong reason to believe that this package was created by a known sender (authentication) and that the message was not altered in transit (integrity); and distributors’ signatures (for example, official marketplace signatures), which are used to ensure that the application permission is officially authorized, release channels and devices are authorized.</p>
                </dd>
                <dt><dfn id="dfn-filename" data-lt="file name|file names" data-dfn-type="dfn">File Name</dfn></dt>
                <dd>The name of any file within a [=MiniApp Package=], either a directory or a file within a directory.</dd>
                <dt><dfn id="dfn-magic-numbers" data-lt="magic numbers|signing block magic numbers" data-dfn-type="dfn">Signing Block Magic Numbers</dfn></dt>
                <dd>A 16-byte sequence with a unique fingerprint that identifies a digital signature mechanism for a [=MiniApp Package=], stored in the Signing Block of [=MiniApp ZIP Container=].</dd>            
                <dt><dfn id="dfn-manifest" data-lt="manifest|manifests" data-dfn-type="dfn">MiniApp Manifest</dfn></dt>
                <dd>A JSON-based file that provides [=processors=] with metadata related to a MiniApp as specified in [[MINIAPP_MANIFEST]]. </dd>
                <dt><dfn id="dfn-package" data-lt="MiniApp Package|MiniApp Packages" data-dfn-type="dfn">MiniApp Package</dfn></dt>
                <dd>A logical document entity composed of a set of [=resources=] packaged in a [=MiniApp ZIP Container=].</dd>
                <dt><dfn id="dfn-processor" data-lt="processors|processor" data-dfn-type="dfn">MiniApp Processor</dfn></dt>
                <dd>A software application that processes [=MiniApp ZIP Containers=] according to the requirements of this specification.</dd>
                <dt><dfn id="dfn-resource" data-lt="resources|resource" data-dfn-type="dfn">MiniApp Resource</dfn></dt>
                <dd>A logical document that is part of the view or the logic of a MiniApp. Resources are included physically in [=MiniApp Packages=].</dd>
                <dt><dfn id="dfn-page" data-lt="pages|page" data-dfn-type="dfn">MiniApp Page</dfn></dt>
                <dd>A collection of information that is displayed in a [=MiniApp User Agent=], under the scope of a specific MiniApp. </dd>
                <dt><dfn id="dfn-useragent" data-lt="MiniApp User <Agent></Agent>|MiniApp User Agents" data-dfn-type="dfn">MiniApp User Agent</dfn></dt>
                <dd>A software application that gets, renders, and enables end-user interaction with a MiniApp.</dd>
                <dt><dfn id="dfn-container" data-lt="MiniApp ZIP Container|MiniApp ZIP Containers" data-dfn-type="dfn">MiniApp ZIP Container</dfn></dt>
                <dd>The ZIP-based packaging and distribution format for MiniApps, as defined in [=MiniApp ZIP Container=].</dd>
                <dt><dfn id="dfn-root-directory" data-lt="root directory|root directories" data-dfn-type="dfn">Root Directory</dfn></dt>
                <dd>The base directory of the [=MiniApp Package=] file system.</dd> 
            </dl>
        </section>
        <section id="conformance">
        </section>
    </section>
    
    <section>
        <h2>Packaging</h2>
        <p>Each MiniApp package is wrapped as a [[ZIP]] file. It contains, at the root level, a global configuration file (<code>manifest.json</code>) to describe and configure the whole MiniApp, an application logic file (<code>app.js</code>), and a default style file (<code>app.css</code>).
        </p>

        <p>The MiniApp package also contains multiple page related files in the <code>pages</code> directory, and other common resource files in the <code>common</code> directory </p>

        <p>One typical illustrative example of a MiniApp package is the following:</p>

        <pre class="example">
            |___manifest.json
            |___app.js
            |___app.css
            |___pages
            |       |___page1.js
            |       |___page1.xml
            |       |___page1.json
            |       |___page1.css
            |___common
            |       |___componentA.js
            |       |___componentA.xml
            |       |___componentA.css
            |       |___componentA.json
            |       |___example.png
            |___i18n
            |       |___zh-Hans.json
            |       |___en-US.json
        </pre>

        <section>
            <h2>root files</h2>
            <p>
                The MiniApp package contains at the root level the global data and lifecycle management of the MiniApp in the form of the following files:
            </p>

            <ul>
                <li><code>manifest.json</code> is responsible for the global configuration of the MiniApp, such as the file paths of MiniApp pages and the window configuration (e.g. navigator bar, background image and color, page title, etc.). Details are specified in the <a href="../manifest/index.html">Manifest specification</a>.</li>
                <li><code>app.css</code> is responsible for the global CSS style for all MiniApp pages.</li>
                <li><code>app.js</code> is responsible for the service logic of the MiniApp as well as the lifecycle management of it, such as launching, showing and hiding the MiniApp.</li>
            </ul>
        </section>
        <section>
            <h2>pages</h2>
            <p>
                The <code>pages</code> directory contains sets of files for the display and user interaction of all MiniApp pages. Each set of files that shares the same base file name (e.g. 'page1') with different extension names describe a particular page on different aspects, such as the service logic (e.g. page1.js), the configuration (e.g. page1.json), the structure (e.g. page1.xml) and the style (e.g page1.css). Developers can choose to put all page files directly under the <code>pages</code> directory in a flat manner, or organize them in different sub-directories for different pages.
            </p>

            <ul>
                <li>A <code>.json</code> file is responsible for the configuration of a MiniApp page.</li>
                <li>A <code>.xml</code> file is responsible for the structure of a MiniApp page, similar to HTML.</li>
                <li>A <code>.css</code> file is responsible for the CSS style of a MiniApp page.</li>
                <li>A <code>.js</code> file is responsible for the service logic and lifecycle management (defined in <a href="https://w3c.github.io/miniapp/specs/lifecycle/">MiniApp Lifecycle</a>) of a MiniApp page.</li>
            </ul>
        </section>

        <section>
            <h2>common</h2>
            <p>The <code>common</code> directory contains common resources such as components, multimedia resources, and utils (js files). Developers can choose to put all resource files directly under the <code>common</code> directory in a flat manner, or organize them in different sub-directories as needed.</p>
        </section>

        <section>
            <h2>i18n</h2>
            <p>
                The <code>i18n</code> directory contains multi-language configuration files to support internationalization. The name of each <code>.json</code> file in this directory follows the <code>Language-Tag</code> as defined in [[BCP47]], and represents the specific configuration for that particular language.
                <p class="note">
                    <span>Note:</span>
                    The detailed format of the <code>.json </code> file is to be further developed.
                </p>
            </p>
        </section>
    </section>

    <section>
        <h2>Security & Privacy Considerations</h2>

        <section>
            <h2>Integrity & Trustworthiness</h2>
            <p>
                To ensure the integrity and trustworthiness, a MiniApp package SHOULD be protected by one or more digital signatures by the author (e.g. the MiniApp developer) and/or distributors (e.g. an application store) along with certificates issued by trusted authorities.
                <li>A digital signature (with a valid certificate) by the author ensures the origin of the MiniApp, so that an end user or a hosting platform can decide whether to install the MiniApp package according to the knowledge about the author (e.g. credits, blocklist, quality).</li>
                <li>A digital signature (with a valid certificate) by a distributor ensures the integrity of the package and trustworthiness of the delivery channel, so that the end user can be protected from tampered software and can benefit from a healthier ecosystem. </li>
            </p>
        
            <p>
                Proven technologies such as [[RFC5652]] (i.e. PKCS#7) can be used as the solution of the digital signatures for MiniApp package. Further evaluation is expected regarding whether it needs to be standardized in detail (e.g. the content scope under protection, additional attributes of concern, file format of the signature block, procedures), or is left to the discretion of implementations.
            </p>
        </section>
        
        <section>
            <h2>Confidentiality</h2>
            <p>
                There is no requirement to develop a standardized encryption mechanism for the MiniApp package to protect its confidentiality. However, it doesn't preclude an implementation from deploying some encryption mechanism for  special purpose.
        
            </p>
        </section>

    </section>

    <section>
        <h2>IANA Considerations</h2>
        <p>
            The proposed MIME type for the MiniApp package is <code>application/miniapp-pkg+zip</code> following <a href="https://tools.ietf.org/html/rfc6839#section-3.6">the +zip Structured Syntax Suffix</a> defined in [[RFC6839]]. It needs to be registered with <a href="https://www.iana.org/">IANA</a> when this work moves to a normative phase. There is no specific fragment identifier consideration for now.
        <p class="note">
            <span>Note:</span>
            A temporary solution could be <code>application/x-w3c-miniapp-pkg+zip</code> for the sake of any early implementation.
        </p>
        </p>
    </section>

</body>

</html>
