<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>MiniApp Packaging</title>
    <script async class="remove" src="https://www.w3.org/Tools/respec/respec-w3c"></script>

    <script class="remove">
        var respecConfig = {
            specStatus: "ED",
            copyrightStart: "2021",
            edDraftURI: "https://w3c.github.io/miniapp-packaging/",

            shortName: "miniapp-packaging",

            editors: [
                {
                    name: "Martin Alvarez-Espinar",
                    companyURL: "http://www.huawei.com",
                    company: "Huawei"
                },          
                {
                    name: "Qing An",
                    companyURL: "http://www.alibabagroup.com/en/global/home",
                    company: "Alibaba"
                },
                {
                    name: "Tengyuan Zhang",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                },         
                {
                    name: "Yongjing Zhang",
                    companyURL: "http://www.huawei.com/",
                    company: "Huawei"
                }, 
                {
                    name: "Dan Zhou",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                }
            ],
            formerEditors: [
                {
                    name: "Shouren Lan",
                    companyURL: "http://www.huawei.com/",
                    company: "Huawei"
                }, 
                {
                    name: "Zhiqiang Yu",
                    companyURL: "http://www.huawei.com/",
                    company: "Huawei"
                }, 
                {
                    name: "Qian Liu",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                }, 
                {
                    name: "Shuo Wang",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                }
            ],
            group: "wg/miniapps",
            github: {
                repoURL: "https://github.com/w3c/miniapp-packaging",
                branch: "main",
            },
            localBiblio: {
                MINIAPP_LIFECYCLE: {
                    title: "MiniApp Lifecycle",
                    href: "https://w3c.github.io/miniapp-lifecycle/"
                },
                MINIAPP_MANIFEST: {
                    title: "MiniApp Manifest",
                    href: "https://w3c.github.io/miniapp-manifest/"
                },
                APK_SIGNATURE_V2: {
                    title: "APK Signature Scheme v2",
                    href: "https://source.android.com/security/apksigning/v2"
                },
            },
            a11y: true,            
        };
    </script>
</head>

<body>
    <section id="abstract">
        <p>This specification defines semantics and conformance requirements for a [=MiniApp Package=], and the structure of the single file container that holds the resources of a MiniApp, including a [=manifest=] file, static page templates, stylesheets, JavaScript documents, media files and other resources. Instances of the [=MiniApp Package=] are used for MiniApp distribution and execution on runtime environments ([=MiniApp User Agent=]).</p>
    </section>
    <section id="sotd">
    </section>
    <section id="sec-introduction">
        <h2>Introduction</h2>
        <section>
            <h3>Overview</h3>
            <p>MiniApp is a concept of light software application, that can be distributed through any digital means, and accessed through the Web. MiniApps are defined by a concrete file structure and all the resources are comprised within a single file that represents the whole MiniApp package that can be distributed and executed by [=MiniApp User Agents=].</p>
            <p>A [=MiniApp Package=] contains a directory structure that holds the specific resources of the MiniApp that defines the rendering, operation, and interaction with the end-users — including static page templates, stylesheets, JavaScript documents, media files, and other resources — and the MiniApp Manifest. The MiniApp Manifest, located in the central directory of the package, describes the MiniApp, including information about page routing, styles, and other operational and rendering details of the MiniApp, as well as descriptive information for humans.</p>
            <p>As defined in the signature section, MiniApps MAY support digital signature verification to guarantee the integrity of the package and contents during the delivery of the package.</p>
            <p>The MiniApp runtime environment ([=MiniApp User Agent=]) identifies MiniApp package files through the standard package format and the specific MIME media type. After fetching the MiniApp package file, the [=MiniApp User Agent=] loads the static page templates, CSS, JavaScript files, and other resources into the cache, following a dereference step. These MiniApp resources will remain available in the cache until the next update, avoiding unnecessary network fetches.</p>
            <p>In terms of launch mode, the MiniApp can be launched normally when offline. The [=MiniApp User Agent=] locates the specified startup page from the package cache path and launches the MiniApp according to the description of the [=manifest=] file.</p>
        </section>
        <section id="sec-terminology">
            <h3>Terminology</h3>
            <p>The following terms are specific to MiniApps.</p>
            <dl class="termlist">
                <dt><dfn id="dfn-signature" data-lt="signatures|signature|Digital Signature|Digital Signatures" data-dfn-type="dfn">Digital Signature</dfn></dt>
                <dd>
                    <p>A cryptographic mechanism and hashing techniques to prove the authenticity of [=resources=]. Digital signatures can demonstrate the origin, time, identity, and status of [=resources=] and of the [=MiniApp Package=].</p>
                    <p>The usual scenario of MiniApps may involve two kinds of signatures: application developer signature, which gives a recipient strong reason to believe that this package was created by a known sender (authentication) and that the message was not altered in transit (integrity); and distributors’ signatures (for example, official marketplace signatures), which are used to ensure that the application permission is officially authorized, release channels and devices are authorized.</p>
                </dd>
                <dt><dfn id="dfn-filename" data-lt="file name|file names" data-dfn-type="dfn">File Name</dfn></dt>
                <dd>The name of any file within a [=MiniApp Package=], either a directory or a file within a directory.</dd>
                <dt><dfn id="dfn-magic-numbers" data-lt="magic numbers|signing block magic numbers" data-dfn-type="dfn">Signing Block Magic Numbers</dfn></dt>
                <dd>A 16-byte sequence with a unique fingerprint that identifies a digital signature mechanism for a [=MiniApp Package=], stored in the Signing Block of [=MiniApp ZIP Container=].</dd>            
                <dt><dfn id="dfn-manifest" data-lt="manifest|manifests" data-dfn-type="dfn">MiniApp Manifest</dfn></dt>
                <dd>A JSON-based file that provides [=processors=] with metadata related to a MiniApp as specified in [[MINIAPP_MANIFEST]]. </dd>
                <dt><dfn id="dfn-package" data-lt="MiniApp Package|MiniApp Packages" data-dfn-type="dfn">MiniApp Package</dfn></dt>
                <dd>A logical document entity composed of a set of [=resources=] packaged in a [=MiniApp ZIP Container=].</dd>
                <dt><dfn id="dfn-processor" data-lt="processors|processor" data-dfn-type="dfn">MiniApp Processor</dfn></dt>
                <dd>A software application that processes [=MiniApp ZIP Containers=] according to the requirements of this specification.</dd>
                <dt><dfn id="dfn-resource" data-lt="resources|resource" data-dfn-type="dfn">MiniApp Resource</dfn></dt>
                <dd>A logical document that is part of the view or the logic of a MiniApp. Resources are included physically in [=MiniApp Packages=].</dd>
                <dt><dfn id="dfn-page" data-lt="pages|page" data-dfn-type="dfn">MiniApp Page</dfn></dt>
                <dd>A collection of information that is displayed in a [=MiniApp User Agent=], under the scope of a specific MiniApp. </dd>
                <dt><dfn id="dfn-useragent" data-lt="MiniApp User <Agent></Agent>|MiniApp User Agents" data-dfn-type="dfn">MiniApp User Agent</dfn></dt>
                <dd>A software application that gets, renders, and enables end-user interaction with a MiniApp.</dd>
                <dt><dfn id="dfn-container" data-lt="MiniApp ZIP Container|MiniApp ZIP Containers" data-dfn-type="dfn">MiniApp ZIP Container</dfn></dt>
                <dd>The ZIP-based packaging and distribution format for MiniApps, as defined in [=MiniApp ZIP Container=].</dd>
                <dt><dfn id="dfn-root-directory" data-lt="root directory|root directories" data-dfn-type="dfn">Root Directory</dfn></dt>
                <dd>The base directory of the [=MiniApp Package=] file system.</dd> 
            </dl>
        </section>
        <section id="conformance">
        </section>
    </section>

    <section id="sec-conformance">
        <h2>Package Conformance</h2>
        <p>A conformant [=MiniApp Package=] MUST meet the following criteria:</p>
        <ul class="conformance-list">
            <li>The file system of a package MUST have a file structure based on a common [=Root Directory=], and three specific subdirectories: <code>common</code>, <code>i18n</code>, and <code>pages</code>.</li>
            <li>It MUST contain one configuration file in the [=Root Directory=], named <code>manifest.json</code>, to describe and configure the runtime environment as defined in [=MiniApp Manifest=].</li>
            <li>It MUST contain one script document, in the [=Root Directory=], named <code>app.js</code>, with the basic control logic of the MiniApp. </li>
            <li>It MUST contain one CSS document, in the [=Root Directory=], named <code>app.css</code>, following the CSS Syntax Module Level 3 [[CSS-SYNTAX-3]].</li>
            <li>The whole [=MiniApp Package=] MUST be wrapped as a [[ZIP]] file, according to the requirements of [=MiniApp ZIP Containers=].</li>
        </ul>
        <p class="ednote" title="To check the support of CSS">
            To clarify if all CSS is supported or just a specific profile.
        </p>
        <p class="ednote" title="To clarify the JS file format/syntax/APIs">
            To clarify the kind of JS file should be included.
        </p>
        <section id="sec-filestructure">
            <h3>Directory and File System Structure</h3>
            <p>The MiniApp Package has a file structure with some restrictions and reserved files and subdirectories.</p> 
            <p>The following example shows a typical file system structure:</p>
            <pre class="example">
                |___manifest.json
                |___app.js
                |___app.css
                |___pages
                |       |___page1.js
                |       |___page1.xml
                |       |___page1.json
                |       |___page1.css
                |___common
                |       |___componentA.js
                |       |___componentA.xml
                |       |___componentA.css
                |       |___componentA.json
                |       |___example.png
                |___i18n
                |       |___zh-Hans.json
                |       |___en-US.json
            </pre>
            <section>
                <h3>Root Directory</h3>
                <p>The [=Root Directory=] of a [=MiniApp Package=] holds several reserved files that include global data and information about the lifecycle management of the MiniApp, including:</p>
                <dl>
                    <dt><code>manifest.json</code></dt>
                    <dd>The [=MiniApp Manifest=] is a JSON document responsible for the global configuration of the MiniApp. A manifest file contains a collection of mandatory and optional attributes that indicate the setup of the MiniApp, including routes and paths of the pages and the window configuration of the MiniApp (e.g., styles of the navigation bar, background image and color, page title, among other), according to the MiniApp Manifest [[MINIAPP_MANIFEST]] specification.</dd>
                    <dt><code>app.css</code></dt>
                    <dd>This file is the default CSS stylesheet, responsible for the global appearance of the [=MiniApp pages=].</dd>
                    <dt><code>app.js</code></dt>
                    <dd>This script document has the basic service logic of the MiniApp and includes the basic control of the MiniApp lifecycle, including the management of events for launch, showing and hiding the  MiniApp.</dd>
                </dl>
                <div class="issue" data-number="5"></div>
            </section>
            <section>
                <h3><code>pages</code> Directory</h3>
                <p>The <code>pages</code> directory contains a set of files for the display and user interaction of the [=MiniApp Pages=]. Each set of files that shares the same base file name (e.g. 'page1') with different extension names describe a particular page on different aspects, such as the service logic (e.g. page1.js), the configuration (e.g. page1.json), the structure (e.g. page1.xml) and the style (e.g page1.css). Developers can choose to put all page files directly under the <code>pages</code> directory in a flat manner or organize them in different sub-directories for different pages.
                </p>
                <ul>
                    <li>A <code>.json</code> file is responsible for the configuration of a MiniApp page. The syntax and structure of these type of files are defined in the <a href="#sec-miniapp-resources-json">JSON Resources</a> section.</li>
                    <li>A <code>.xml</code> file is responsible for the structure of a MiniApp page, similar to HTML. The syntax and structure of these type of files are defined in the <a href="#sec-miniapp-resources-xml">XML Resources</a> section.</li>
                    <li>A <code>.css</code> file is responsible for the CSS style of a MiniApp page. The syntax and structure of these type of files are defined in the <a href="#sec-miniapp-resources-css">CSS Resources</a> section.</li>
                    <li>A <code>.js</code> file is responsible for the service logic and lifecycle management (defined in MiniApp Lifecycle [[MINIAPP_LIFECYCLE]]) of a MiniApp page. The syntax and structure of these type of files are defined in the <a href="#sec-miniapp-resources-js">JS Resources</a> section.</li>
                </ul>
                <div class="issue" data-number="3"></div> 
            </section>
            <section>
                <h3><code>common</code> Directory</h3>
                <p>The <code>common</code> directory contains resources such as components, multimedia resources, and libraries that are accessible from all [=MiniApp Pages=] in a MiniApp. The internal structure of this directory is flexible, so these common resources MAY be organized in customized subdirectories, and using different name conventions, as needed.</p>
            </section>
            <section>
                <h3><code>i18n</code> Directory</h3>
                <p>The <code>i18n</code> directory contains multi-language configuration files to support the internationalization of the MiniApp. The file name of each <code>.json</code> document in this directory follows the <code>Language-Tag</code> notation as defined in [[BCP47]], and represents the specific configuration for that particular language.</p>
                <p class="ednote" title="Still to define the format">
                        The detailed format of the <code>.json </code> file is to be further developed.
                </p>
                <p class="ednote" title="Still to define the locale file selection">
                        To define the detailed process of file selection according to the system locale.
                </p>
            </section>
            <section>
                <h3>File Names</h3>
                <p>Any [=File Name=] within a [=MiniApp Package=] MUST comply with the following restrictions to accomodate the potential limitations of the operating systems and facilitate the compatibility with the majority of the platforms:</p>

                <ul class="conformance-list">
                    <li>File Names are case sensitive</li>
                    <li>File Names MUST be UTF-8 [[Unicode]] encoded.</File>
                    <li>File Names MUST NOT exceed 255 bytes.</li>
                    <li>File Names MUST NOT use the following [[Unicode]] characters:
                        <ul>
                            <li>LESS-THAN SIGN: <code><</code> (<code>U+003C</code>)</li>
                            <li>GREATER-THAN SIGN: <code>></code> (<code>U+003E</code>)</li>
                            <li>COLON: <code>:</code> (<code>U+003A</code>)</li>
                            <li>QUESTION MARK: <code>?</code> (<code>U+003F</code>)</li>
                            <li>SOLIDUS: <code>/</code> (<code>U+002F</code>)</li>
                            <li>REVERSE SOLIDUS: <code>\</code> (<code>U+005C</code>)</li>
                            <li>VERTICAL LINE: <code>|</code> (<code>U+007C</code>)</li>
                            <li>ASTERISK: <code>*</code> (<code>U+002A</code>)</li>
                            <li>QUOTATION MARK: <code>"</code> (<code>U+0022</code>)</li>
                            <li>FULL STOP at the end: <code>.</code> (<code>U+002E</code>)</li>
                            <li>DEL (<code>U+007F</code>)</li>
                            <li>C0 range (<code>U+0000</code> … <code>U+001F</code>)</li>
                            <li>C1 range (<code>U+0080</code> … <code>U+009F</code>)</li>
                        </ul>
                    </li>
                </ul>
                <div class="ednote">
                    To complete the list of restricted characters.
                </div>                
            </section>
        </section>
        <section id="sec-miniapp-resources">
            <h3>MiniApp Resources</h3>
            <p class="ednote">To add more text about the resources</p>
            <section id="sec-miniapp-resources-json">
                <h3>JSON Resources</h3>
                <div class="issue" data-number="3"></div>
            </section>
            <section id="sec-miniapp-resources-xml">
                <h3>XML Resources</h3>
                <div class="issue" data-number="2"></div>
            </section>
            <section id="sec-miniapp-resources-css">
                <h3>CSS Resources</h3>
            </section>
            <section id="sec-miniapp-resources-js">
                <h3>JS Resources</h3>
            </section>
            <section id="sec-miniapp-resources-other">
                <h3>Other Resources</h3>
                <div class="ednote">To add images, libraries and others.</div>
            </section>
        </section> 
    </section>
        
    <section>
        <h2>Security & Privacy Considerations</h2>

        <section>
            <h2>Integrity & Trustworthiness</h2>
            <p>
                To ensure the integrity and trustworthiness, a MiniApp package SHOULD be protected by one or more digital signatures by the author (e.g. the MiniApp developer) and/or distributors (e.g. an application store) along with certificates issued by trusted authorities.
                <li>A digital signature (with a valid certificate) by the author ensures the origin of the MiniApp, so that an end user or a hosting platform can decide whether to install the MiniApp package according to the knowledge about the author (e.g. credits, blocklist, quality).</li>
                <li>A digital signature (with a valid certificate) by a distributor ensures the integrity of the package and trustworthiness of the delivery channel, so that the end user can be protected from tampered software and can benefit from a healthier ecosystem. </li>
            </p>
        
            <p>
                Proven technologies such as [[RFC5652]] (i.e. PKCS#7) can be used as the solution of the digital signatures for MiniApp package. Further evaluation is expected regarding whether it needs to be standardized in detail (e.g. the content scope under protection, additional attributes of concern, file format of the signature block, procedures), or is left to the discretion of implementations.
            </p>
        </section>
        
        <section>
            <h2>Confidentiality</h2>
            <p>
                There is no requirement to develop a standardized encryption mechanism for the MiniApp package to protect its confidentiality. However, it doesn't preclude an implementation from deploying some encryption mechanism for  special purpose.
        
            </p>
        </section>

    </section>

    <section>
        <h2>IANA Considerations</h2>
        <p>
            The proposed MIME type for the MiniApp package is <code>application/miniapp-pkg+zip</code> following <a href="https://tools.ietf.org/html/rfc6839#section-3.6">the +zip Structured Syntax Suffix</a> defined in [[RFC6839]]. It needs to be registered with <a href="https://www.iana.org/">IANA</a> when this work moves to a normative phase. There is no specific fragment identifier consideration for now.
        <p class="note">
            <span>Note:</span>
            A temporary solution could be <code>application/x-w3c-miniapp-pkg+zip</code> for the sake of any early implementation.
        </p>
        </p>
    </section>

</body>

</html>
